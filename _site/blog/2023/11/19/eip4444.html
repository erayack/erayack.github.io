<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" width="device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="Mark Qi">
	<!-- favicon -->
	<link rel="shortcut icon" type="image/x-icon" href="/assets/menu-favicon.ico"/>
	
	<title>Using The Graph to Preserve Historical Data and Enable EIP-4444 | Eray Ack</title>		
	<!-- styles -->
	<link rel="stylesheet" type="text/css" href="/assets/css/main.css">

	<!-- google analytics - i will not share this data with google -->
	<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src=""></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-154465690-1');
</script>
	
</head><body><header class="site-header">
  <div class="wrapper"><nav class="site-nav">
      <div class="trigger"><a class="page-link" href="/">
          Home
        </a><a class="page-link" href="/projects/">
          Projects
        </a><a class="page-link" href="/blog/">
          Writings
        </a><a class="page-link" href="/resume/">
          Resume
        </a></div>
    </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <h2>Using The Graph to Preserve Historical Data and Enable EIP-4444</h2>
<p class="meta">19 Nov 2023</p>

<div class="post">
  <p>See the original proposal on <a href="https://ethresear.ch/t/using-the-graph-to-preserve-historical-data-and-enable-eip-4444/">ETH Research</a>.</p>

<h2 id="summary">Summary</h2>

<p>The Graph’s Indexers use Firehose to extract and store blockchain data in flat files, which are Google protobuf serialized object storage. These flat files contain all the necessary information to preserve the complete history of data stored in the blockchain, specifically block bodies and receipts. We suggest that these flat files can be used as an archival data format, similar to era and era1 files. We also demonstrate how the data stored in flat files can be verified to belong to the canonical blockchain. Once EIP-4444 is in effect for The Graph, Indexers can share flat files to obtain the required historical data for indexing and querying. The Graph’s network of incentivized Indexers ensures that historical data is preserved and available for Ethereum, providing a decentralized and independent solution for EIP-4444.</p>

<p>Flat files store top-level transaction data and receipts from transaction execution. These files are verifiable and shareable, making them a suitable candidate for an archive format. They contain all the information needed to reconstruct the transaction and receipt tries, which are committed to every block in the canonical blockchain. To verify that the data in a flat file belongs to the canonical blockchain, one only needs to confirm that the roots of these constructed tries match the roots stored in a canonical block header.</p>

<p>Post-merge, information from the Consensus Layer can be used to validate block headers from the canonical blockchain. For example, Ethereum provides the sync-committee subprotocol for this purpose. To verify the correctness of data stored in a post-merge flat file, one needs to reconstruct the receipt and transaction tries for the block in the flat file and compare these roots to a valid sync committee signed block header. Valid block headers can be obtained from a consensus light client. Our proof-of-concept code demonstrates how this verification can be done.</p>

<p>The flat file format generated by The Graph’s Firehose offers a decentralized and verifiable solution for preserving Ethereum’s historical data after EIP-4444 is implemented. We have shown that flat files contain all the necessary blockchain data and can be verified against the canonical chain. We are actively developing our open-source flat file verification code, which can be used to verify downloaded flat files. Our vision is for Indexers in The Graph protocol to use this code to distribute and monetize flat files in a data service marketplace, rather than syncing a full node using Ethereum’s p2p network.</p>

<p>The Graph network naturally enables and incentivizes a unique EIP-4444 solution. The flat files generated and used by Indexers can also serve as a shareable and</p>

<h2 id="links">Links</h2>

<p>See the original proposal on <a href="https://ethresear.ch/t/using-the-graph-to-preserve-historical-data-and-enable-eip-4444/">ETH Research</a>.</p>

</div>

      </div>
    </main><footer>
	<div style="display: flex; justify-content: space-between; align-items: center;">
	  <p>By <a href="/">Eray</a></p>
	  <div style="display: flex; align-items: center;">
		<a href="https://x.com/erayajk" style="margin-right: 10px;">X</a>
		<a href="https://warpcast.com/eray" style="margin-right: 10px;">Farcaster</a>
		<a href="https://www.github.com/erayack/" style="margin-right: 10px;">Github</a>
		<a href="https://www.linkedin.com/in/erayack/" style="margin-right: 10px;">LinkedIn</a>
		<a href="mailto:erayackgoz@hotmail.com">Mail</a>
	  </div>
	</div>
  </footer>
  </body>

</html>
